{% extends 'layout.html' %}

{% block content %}
<style>
    
    /* === 页面布局优化 === */
    .profile-container {
        padding-top: 50px;
        padding-bottom: 80px;
    }

    /* 1. 卡片优化：增加内边距，让内容不拥挤 */
    .card-center {
        border: none;
        border-radius: 20px;
        background: #fff;
        box-shadow: 0 15px 35px rgba(0,0,0,0.05); /* 更柔和的高级阴影 */
        max-width: 480px; /* 限制卡片最大宽度，防止太宽显得散 */
        margin: 0 auto;   /* 卡片水平居中 */
    }
    
    .card-padding {
        padding: 40px 50px; /* 核心：增加内部留白 */
    }

    /* 2. 头像区域优化 */
    .avatar-section {
        margin-bottom: 35px;
        position: relative;
    }
    .avatar-wrapper {
        width: 100px;
        height: 100px;
        margin: 0 auto 15px;
        position: relative;
    }
    .avatar-img {
        width: 100%; height: 100%;
        object-fit: cover;
        border-radius: 50%;
        border: 4px solid #fff;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    /* 3. 标签优化：缩小、变灰、增加下间距 */
    .form-group {
        margin-bottom: 24px; /* 拉大组与组之间的距离 */
    }
    .form-label-styled {
        display: block;
        font-size: 0.85rem;     /* 字号改小，精致感 */
        color: #5E6C84;         /* 颜色改浅，不再死黑 */
        font-weight: 600;
        margin-bottom: 8px;     /* 标签和输入框分开一点 */
        margin-left: 2px;       /* 微调对齐 */
    }

    /* 4. 输入框优化：高度适中，圆角舒适 */
    .form-input-styled {
        height: 44px;
        border-radius: 8px;
        border: 1px solid #DFE1E6;
        padding-left: 40px; /* 给图标留位置 */
        font-size: 0.95rem;
        color: #172B4D;
        width: 100%;
        background: #fff;
        transition: all 0.2s;
    }
    .form-input-styled:focus {
        border-color: #5E5DF0;
        box-shadow: 0 0 0 3px rgba(94, 93, 240, 0.1);
        background: #fff;
    }
    
    /* 图标定位 */
    .input-icon-wrapper {
        position: relative;
    }
    .input-inner-icon {
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: #97A0AF;
        font-size: 1.1rem;
    }

    /* 5. 按钮与链接优化 */
    .btn-upload-simple {
        background: #F0F0FF;
        color: #5E5DF0;
        border: none;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }
    .btn-upload-simple:hover {
        background: #E6E6FF;
    }

    .action-area {
        margin-top: 35px;
        display: flex;
        justify-content: center; /* 按钮居中 */
        align-items: center;
        gap: 20px; /* 按钮和文字链接的间距 */
    }
    .btn-save-main {
        background: #5E5DF0;
        color: #fff;
        border: none;
        height: 42px;
        padding: 0 32px;
        border-radius: 21px; /* 胶囊形状 */
        font-weight: 600;
        box-shadow: 0 4px 10px rgba(94, 93, 240, 0.3);
        transition: all 0.2s;
    }
    .btn-save-main:hover {
        background: #4b4ac2;
        transform: translateY(-1px);
    }
    .link-back {
        color: #6B778C;
        font-size: 0.9rem;
        text-decoration: none;
        transition: color 0.2s;
    }
    .link-back:hover {
        color: #172B4D;
    }
    
    /* 提示文字 */
    .hint-text {
        font-size: 0.75rem;
        color: #97A0AF;
        margin-top: 6px;
        margin-left: 2px;
    }
    
    /* 只读状态 */
    .input-readonly {
        background: #F4F5F7 !important;
        border-color: transparent;
        color: #7A869A;
    }
</style>

<div class="container profile-container" style="transform: scale(0.9); transform-origin: top center;">

    <div class="card-center fade-in-up">
        <div class="card-padding">
            
            <!-- 标题区 -->
            <div class="text-center mb-4">
                <h3 class="text-bold mb-1" style="color: #172B4D; font-size: 1.5rem;">编辑个人资料</h3>
                <p class="text-gray" style="font-size: 0.9rem;">完善信息让更多人认识你</p>
            </div>

            <form method="POST" enctype="multipart/form-data">
                
                <!-- 头像区 -->
                <div class="avatar-section text-center">
                    <div class="avatar-wrapper">
                        <img id="avatar-preview-img" 
                             src="{{ url_for('static', filename='uploads/' + user.avatar) }}" 
                             class="avatar-img">
                    </div>
                    
                    <input id="upload-avatar-input" class="d-none" type="file" name="avatar" accept="image/*">
                    
                    <label for="upload-avatar-input" class="btn-upload-simple">
                        <i class="ri-camera-fill mr-1"></i> 更换头像
                    </label>

                    <!-- 错误提示 -->
                    <div id="compression-tip" style="display: none; margin-top: 10px;">
                        <span class="text-error text-tiny d-block mb-1">图片过大 (>300KB)</span>
                        <a href="https://img.bupang.xyz/imageKit.html" target="_blank" style="font-size: 12px; color: #5E5DF0; text-decoration: underline;">
                            去这里压缩一下 &rarr;
                        </a>
                    </div>
                </div>

                <!-- 表单区 -->
                
                <!-- 1. 昵称 -->
                <div class="form-group">
                    <label class="form-label-styled">用户昵称</label>
                    <div class="input-icon-wrapper">
                        <i class="ri-user-3-line input-inner-icon"></i>
                        <input class="form-input-styled" name="username" 
                               value="{{ user.username if user.username and user.username != 'None' else '' }}" 
                               placeholder="给自己起个好听的名字" required>
                    </div>
                </div>

                <!-- 2. 介绍 -->
                <div class="form-group">
                    <label class="form-label-styled">一句话介绍 (专业/年级)</label>
                    <div class="input-icon-wrapper">
                        <i class="ri-id-card-line input-inner-icon"></i>
                        <input class="form-input-styled" name="bio" 
                               value="{{ user.bio if user.bio and user.bio != 'None' else '' }}" 
                               placeholder="这位同学很懒，什么也没写">
                    </div>
                    <div class="hint-text">这将显示在你的个人主页卡片上</div>
                </div>

                <!-- 3. 邮箱 -->
                <div class="form-group">
                    <label class="form-label-styled">邮箱账号</label>
                    <div class="input-icon-wrapper">
                        <i class="ri-mail-line input-inner-icon"></i>
                        <input class="form-input-styled input-readonly" 
                               value="{{ user.email }}" readonly disabled>
                    </div>
                </div>

                <!-- 底部按钮 -->
                <div class="action-area">
                    <a href="/" class="link-back">返回首页</a>
                    <button type="submit" class="btn-save-main">
                        <i class="ri-save-3-line mr-1"></i> 保存更改
                    </button>
                </div>

            </form>
        </div>
    </div>
    
    <div class="text-center mt-3 text-gray text-tiny opacity-50">
        UniAsk Profile Setting
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('upload-avatar-input');
    const previewImg = document.getElementById('avatar-preview-img');
    const tipBox = document.getElementById('compression-tip');

    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const maxSize = 300 * 1024; 
        if (file.size > maxSize) {
            tipBox.style.display = 'block';
            alert("⚠️ 图片太大了！\n\n请使用下方的「在线压缩工具」处理后再上传。");
            fileInput.value = ''; 
            return;
        }
        tipBox.style.display = 'none';
        const reader = new FileReader();
        reader.onload = function(e) {
            previewImg.src = e.target.result;
        }
        reader.readAsDataURL(file);
    });
});
</script>
{% endblock %}