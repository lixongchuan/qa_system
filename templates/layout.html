<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>UniAsk æ ¡å›­åœˆ</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <!-- åŸºç¡€æ ·å¼åº“ -->
    <link rel="stylesheet" href="{{url_for('static', filename='css/spectre.min.css')}}">
    <!-- å¼•å…¥ Remix Icon (æ›´ç°ä»£çš„å›¾æ ‡åº“) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/remixicon.css') }}">
    <!-- JQuery -->
    <script src="{{url_for('static', filename='js/jquery-3.3.1.min.js')}}"></script>
    
    <style>
        /* === 1. è®¾è®¡ç³»ç»Ÿå˜é‡ === */
        :root {
            --primary: #5E5DF0;  /* ç¨å¾®åç´«è“çš„ç°ä»£è‰² */
            --primary-hover: #4a49c9;
            --bg-body: #F5F7FA;  /* æŸ”å’Œçš„ç°ç™½èƒŒæ™¯ */
            --text-main: #1F2D3D;
            --text-light: #8492A6;
            --card-radius: 12px; /* æ›´å¤§çš„åœ†è§’ */
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-hover: 0 12px 24px rgba(94, 93, 240, 0.12); /* æ‚¬æµ®æ—¶çš„å½©è‰²é˜´å½± */
        }


        /* 1. å¼ºåˆ¶æŠŠå†…å®¹å®¹å™¨æåˆ°æœ€ä¸Šå±‚ */
        .modal-container {
            position: relative !important;
            z-index: 9999 !important; /* æ•°å€¼è®¾å¾—å¾ˆå¤§ï¼Œä¿è¯åœ¨æœ€ä¸Šé¢ */
            background: #fff; /* ç¡®ä¿èƒŒæ™¯ä¸é€æ˜ */
        }

        /* 2. ç¡®ä¿é®ç½©å±‚åœ¨å†…å®¹å®¹å™¨çš„ä¸‹é¢ */
        .modal-overlay {
            z-index: 999 !important; /* æ•°å€¼æ¯” container å° */
            background: rgba(0, 0, 0, 0.45) !important; /* å¦‚æœä½ æƒ³è¦æ·±è‰²èƒŒæ™¯ï¼Œç”¨è¿™è¡Œ */
            /* background: rgba(255, 255, 255, 0.75) !important; å¦‚æœä½ æƒ³è¦ä¹‹å‰çš„æµ…è‰²ç£¨ç ‚æ„Ÿï¼Œç”¨è¿™è¡Œ */
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif;
            -webkit-font-smoothing: antialiased; /* è®©å­—ä½“æ›´æ¸…æ™° */
        }

        /* === 2. å¯¼èˆªæ é‡æ„ï¼šè§£å†³ç²˜è¿é—®é¢˜ === */
        .navbar {
            background: #fff;
            height: 72px; /* å¢åŠ é«˜åº¦ */
            box-shadow: 0 1px 0 rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 0 20px; /* å·¦å³å¢åŠ å†…è¾¹è· */
        }
        
        /* ä½¿ç”¨ Flexbox å¼ºåˆ¶åˆ†å¼€ Logo å’Œ ç”¨æˆ·èœå• */
        .navbar-container {
            display: flex;
            justify-content: space-between; /* å…³é”®ï¼šä¸¤ç«¯å¯¹é½ */
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            height: 100%;
        }

        /* ä¸ªæ€§åŒ– Logo */
        .brand-logo {
            font-size: 1.6rem;
            font-weight: 900;
            color: var(--text-main) !important;
            text-decoration: none;
            display: flex;
            align-items: center;
            letter-spacing: -0.5px;
        }
        .brand-icon {
            color: #fff;
            background: linear-gradient(135deg, #5E5DF0, #00C6FB);
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(94, 93, 240, 0.3);
        }

        /* === 3. å¡ç‰‡ä¼˜åŒ–ï¼šå¢åŠ å‘¼å¸æ„Ÿ === */
        .card {
            border: none;
            border-radius: var(--card-radius);
            background: #fff;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            margin-bottom: 24px; /* å¢åŠ å¡ç‰‡é—´è· */
            overflow: hidden;
        }
        .card:hover {
            transform: translateY(-4px); /* æ‚¬æµ®ä¸Šç§» */
            box-shadow: var(--shadow-hover);
        }
        .card-body {
            padding: 1.5rem; /* å¢åŠ å†…éƒ¨ç•™ç™½ */
        }
        .card-footer {
            background: transparent;
            padding: 1rem 1.5rem;
            border-top: 1px solid #f0f0f0;
        }

        /* === 4. æŒ‰é’®ä¸äº¤äº’ === */
        .btn {
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s;
            height: 38px;
        }
        .btn-primary {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(94, 93, 240, 0.25);
        }
        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }
        
        /* æŠ•ç¥¨æŒ‰é’®ç¾åŒ– */
        .vote-btn {
            background: #F2F3F5;
            color: #5F6368;
            border: none;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .vote-btn i { margin-right: 4px; font-size: 1.1rem; }
        .vote-btn:hover { background: #E5E6EB; }
        
        .vote-btn.active-up { background: #E8F0FE; color: var(--primary); }
        .vote-btn.active-down { background: #FEE2E2; color: #EF4444; }

        /* === 5. åŠ¨ç”»ç±» === */
        .fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        /* === 6. æ‚é¡¹å¾®è°ƒ === */
        .navbar .avatar { width: 36px; height: 36px; border: 2px solid #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
        .text-light { color: var(--text-light) !important; }
        
        /* å¤´åƒåå­—åŒºåŸŸ */
        .user-menu-btn {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--text-main);
            font-weight: 600;
            padding: 5px 10px;
            border-radius: 20px;
            transition: background 0.2s;
        }
        .user-menu-btn:hover { background: #f0f0f0; text-decoration: none; }
        
        /* ä¾§è¾¹æ æ ‡é¢˜è£…é¥° */
        .sidebar-heading {
            font-size: 0.85rem;
            color: #8492A6;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            margin-bottom: 12px;
            margin-top: 5px;
        }
    </style>
</head>
<body>

<!-- å¯¼èˆªæ  -->
<header class="navbar">
    <div class="navbar-container">
        <!-- å·¦ä¾§ï¼šLogo -->
        <a href="/" class="brand-logo">
            <div class="brand-icon"><i class="ri-planet-line"></i></div>
            UniAsk<span style="font-weight: 400; font-size: 1.2rem; margin-left: 6px; color: #555;">æ ¡å›­åœˆ</span>
        </a>
        
        <!-- å³ä¾§ï¼šç”¨æˆ·èœå• -->
        <div>
            {% if current_user.is_authenticated %}
                <div class="dropdown dropdown-right">
                    <a href="#" class="user-menu-btn dropdown-toggle" tabindex="0">
                        <figure class="avatar mr-2">
                            <img src="{{ url_for('static', filename='uploads/' + current_user.avatar) }}">
                        </figure>
                        <span>{{ current_user.username }}</span>
                        <i class="ri-arrow-down-s-line ml-1"></i>
                    </a>
                    <ul class="menu" style="min-width: 180px; padding: 10px; border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-radius: 12px; margin-top: 10px;">
                        <li class="menu-item"><a href="/profile"><i class="ri-settings-3-line mr-2"></i> ä¸ªäººè®¾ç½®</a></li>
                        <li class="menu-divider"></li>
                        <li class="menu-item"><a href="/logout" style="color: #ef4444;"><i class="ri-logout-box-r-line mr-2"></i> é€€å‡ºç™»å½•</a></li>
                    </ul>
                </div>
            {% else %}
                <a href="/login" class="btn btn-link">ç™»å½•</a>
                <a href="/register" class="btn btn-primary ml-2">åŠ å…¥ç¤¾åŒº</a>
            {% endif %}
        </div>
    </div>
</header>

<div class="container grid-xl" style="padding-top: 40px; padding-bottom: 60px;">
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="toast toast-primary mb-2 shadow-sm" style="border-radius: 8px;">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    {% block content %}{% endblock %}
</div>

<!-- æé—®å¼¹çª— (ç¾åŒ–ç‰ˆ) -->
{% if current_user.is_authenticated %}
<div class="modal" id="ask-question-modal">
    <a href="#close" class="modal-overlay" aria-label="Close"></a>
    <div class="modal-container" style="border-radius: 16px; box-shadow: 0 20px 50px rgba(0,0,0,0.2);">
        <div class="modal-header">
            <a href="#close" class="btn btn-clear float-right" aria-label="Close"></a>
            <div class="modal-title h5 text-bold"><i class="ri-question-answer-line mr-2" style="color: var(--primary);"></i>å‘èµ·æ–°è®¨è®º</div>
        </div>
        <div class="modal-body">
            <div class="content">
                <form>
                    <div class="form-group">
                        <label class="form-label">æ ‡é¢˜</label>
                        <input class="form-input input-lg" id="question_title" type="text" placeholder="èµ·ä¸ªå¸å¼•äººçš„æ ‡é¢˜..." style="font-weight: bold;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">è¯¦æƒ…</label>
                        <textarea class="form-input" id="question_detail" rows="5" placeholder="è¯·è¯¦ç»†æè¿°ä½ çš„é—®é¢˜èƒŒæ™¯ã€æ¡ä»¶ç­‰..."></textarea>
                    </div>
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-link" onclick="$('.modal').removeClass('active')">å–æ¶ˆ</button>
            <button class="btn btn-primary" id="post-question">ğŸš€ ç«‹å³å‘å¸ƒ</button>
        </div>
    </div>
</div>
{% endif %}

<script>
    $('.trigger-ask').click(function(){ $('#ask-question-modal').addClass('active'); });
    $('.modal-overlay, .btn-clear').click(function(){ $('.modal').removeClass('active'); });
    $('#post-question').click(function(){
        var title = $('#question_title').val();
        var detail = $('#question_detail').val();
        if(!title) { alert('æ ‡é¢˜ä¸èƒ½ä¸ºç©º'); return; }
        $.ajax({
            type: "post",
            url: '/post_question',
            data: JSON.stringify({title: title, detail: detail}),
            contentType: "application/json",
            success: function(data) { window.location.reload(); }
        });
    });
</script>
{% block scripts %}{% endblock %}
</body>
</html>